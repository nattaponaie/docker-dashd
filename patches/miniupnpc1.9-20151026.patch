From acc28458c6b5e064af837b57eec8e2dfe101d833 Mon Sep 17 00:00:00 2001
From: TheLazieR Yip <thelazier@gmail.com>
Date: Wed, 9 Dec 2015 16:06:41 +0700
Subject: [PATCH] Bump miniupnpc version to 1.9.20151026

---
 depends/packages/miniupnpc.mk | 4 ++--
 src/net.cpp                   | 6 +++++-
 2 files changed, 7 insertions(+), 3 deletions(-)

diff --git a/depends/packages/miniupnpc.mk b/depends/packages/miniupnpc.mk
index 00101f1..8cda770 100644
--- a/depends/packages/miniupnpc.mk
+++ b/depends/packages/miniupnpc.mk
@@ -1,8 +1,8 @@
 package=miniupnpc
-$(package)_version=1.9.20140701
+$(package)_version=1.9.20151026
 $(package)_download_path=http://miniupnp.free.fr/files
 $(package)_file_name=$(package)-$($(package)_version).tar.gz
-$(package)_sha256_hash=26f3985bad7768b8483b793448ae49414cdc4451d0ec83e7c1944367e15f9f07
+$(package)_sha256_hash=f3cf9a5a31588a917d4d9237e5bc50f84d00c5aa48e27ed50d9b88dfa6a25d47
 
 define $(package)_set_vars
 $(package)_build_opts=CC="$($(package)_cc)"
diff --git a/src/net.cpp b/src/net.cpp
index 3f39f39..be7ba92 100644
--- a/src/net.cpp
+++ b/src/net.cpp
@@ -1050,10 +1050,14 @@ void ThreadMapPort()
 #ifndef UPNPDISCOVER_SUCCESS
     /* miniupnpc 1.5 */
     devlist = upnpDiscover(2000, multicastif, minissdpdpath, 0);
-#else
+#elif MINIUPNPC_API_VERSION < 14
     /* miniupnpc 1.6 */
     int error = 0;
     devlist = upnpDiscover(2000, multicastif, minissdpdpath, 0, 0, &error);
+#else
+    /* miniupnpc 1.9.20150730 */
+    int error = 0;
+    devlist = upnpDiscover(2000, multicastif, minissdpdpath, 0, 0, 2, &error);
 #endif
 
     struct UPNPUrls urls;
